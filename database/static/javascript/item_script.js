function add_item(e){var t=document.getElementById("block-selector").value,i=document.getElementById("blocks-table-"+t),n=i.querySelector(".gold-cost"),a=document.createElement("td"),l=document.createElement("img"),d=parseInt(n.innerHTML);n.innerHTML=d+parseInt(e.dataset.cost),l.src=e.dataset.icon,l.id=e.id,l.dataset.stats=e.dataset.stats,l.dataset.cost=e.dataset.cost,l.addEventListener("click",function(){remove_item(l)}),i.rows[0].children.length>0&&a.appendChild(document.createTextNode("+")),a.appendChild(l),i.rows[0].appendChild(a),stats_table.updateStats(!0,e.dataset.stats)}function remove_item(e){var t=e.parentNode.parentNode,i=e.parentNode.nextSibling;t.children[0]===e.parentNode&&i&&i.removeChild(i.childNodes[0]),t.removeChild(e.parentNode);var n=t.parentNode.querySelector(".gold-cost"),a=parseInt(n.innerHTML);n.innerHTML=a-parseInt(e.dataset.cost);var l=document.getElementById("block-selector"),d=l.selectedIndex;t.parentNode.querySelector("caption").id==l.options[d].id&&stats_table.updateStats(!1,e.dataset.stats)}function add_block(){var e=document.getElementById("blocks");if(!(e.childElementCount>=9)){number_of_blocks++;var t=document.createElement("table");t.id="blocks-table-"+number_of_blocks.toString(),t.classList.add("blocks-table");var i=document.createElement("tr"),n=document.createElement("input");n.type="checkbox",n.value="recmath",n.title="Click if this all the items in this block should build into the last.",t.appendChild(n);var a=document.createElement("p");a.title="Should all the items in this block build into the last?",a.classList.add("recmath-text"),a.innerHTML="Recmath",a.addEventListener("click",function(){var e=n.checked;n.checked=e?!1:!0}),t.appendChild(a);var l=document.createElement("p");l.title="Total gold cost of all the items in this block.",l.classList.add("gold-cost"),l.appendChild(document.createTextNode(0)),t.appendChild(l),t.appendChild(i);var d=t.createCaption();d.id="block-caption-"+number_of_blocks.toString(),d.classList.add("block-caption"),d.innerHTML="<span>Block</span> <input value='Block' />",d.title="Click me to set the name of block",caption_edit.bindEvents(t);var s=document.createElement("button");s.classList.add("hide-buttons"),s.innerHTML=">",s.title="Toggle hiding of item set",s.addEventListener("click",function(){toggle_block(t,a,n,d,l,this)}),t.insertBefore(s,d);var o=document.getElementById("block-selector"),r=document.createElement("option");r.id="block-caption-"+number_of_blocks.toString(),r.value=number_of_blocks,r.innerHTML=d.innerHTML,o.appendChild(r),o.selectedIndex=o.length-1,e.appendChild(t),stats_table.changeBlock(o)}}function remove_block(){var e=document.getElementById("blocks"),t=document.getElementById("block-selector"),i=document.getElementById("blocks-table-"+t.value);e.removeChild(i),t.remove(t.selectedIndex),0===e.childElementCount&&add_block(),t.selectedIndex=t.length-1,stats_table.changeBlock(t)}function toggle_block(e,t,i,n,a,l){e.rows[0].classList.toggle("hide"),t.classList.toggle("hide"),i.classList.toggle("hide"),n.classList.toggle("shrink"),a.classList.toggle("gold-cost-shrink"),l.classList.toggle("hide-buttons-shrink"),l.innerHTML="V"===l.innerHTML?">":"V"}function toggle_items(e){var t=document.getElementById("items-div");t.classList.toggle("hide"),e.innerHTML="^"==e.innerHTML?"V":"^";var i=e.parentNode;i.classList.contains("toggle-items")?(i.classList.add("toggle-items-hidden"),i.classList.remove("toggle-items")):(i.classList.add("toggle-items"),i.classList.remove("toggle-items-hidden"))}function item_info_build(e,t){for(var n=document.getElementById("item-builds-"+e+"-field");n.lastChild;)n.removeChild(n.lastChild);var a="into"==e?t.dataset.into:t.dataset.from,l=JSON.parse(a.replace(/'/g,'"'));if(""!=l[0])for(n.parentNode.classList.remove("hide"),i=0;i<l.length;i++){var d=document.getElementById("item-icons-div").querySelector("#item-"+l[i]),s=d.parentNode.cloneNode(!0),o=s.querySelector("img");o.addEventListener("click",function(){item_info(this)}),s.classList.remove("hide"),n.appendChild(s)}else n.parentNode.classList.add("hide")}function item_info(e){for(var t=document.getElementById("item-info-name");t.lastChild;)t.removeChild(t.lastChild);t.appendChild(document.createTextNode(e.alt));for(var i=document.getElementById("item-info-icon");i.lastChild;)i.removeChild(i.lastChild);var n=e.parentNode.cloneNode(!0),a=n.querySelector("img");a.addEventListener("click",function(){add_item(this)}),i.appendChild(n);for(var l=document.getElementById("item-info-description");l.lastChild;)l.removeChild(l.lastChild);l.appendChild(document.createTextNode(e.dataset.description));var d=document.getElementById("item-info-stats"),s=stats_table.convertJSON(e.dataset.stats);delete s.ItemID_id;var o="";for(stats in s)o+='<p class="item-info-left">'+stats_table.stats_names[stats_table.trimStats(stats)]+':</p><p class="item-info-right">'+s[stats]+"</p><br />";d.innerHTML=o,item_info_build("into",e),item_info_build("from",e)}function filter_string(e){var t=document.getElementById("filter-div");t.querySelector("span").innerHTML=e,t.querySelector("input").value=e,filter(e,"item")}function build_item_set(e){var t=document.getElementById("blocks"),i={},n=[],a=document.getElementById("item-set-name"),l=document.getElementById("map-selector");i.name=a.value,i.map=l.value;for(var d=0;d<t.childElementCount;d++){var s={},o=t.children[d];s.name=o.querySelector("caption").querySelector("span").innerHTML,s.recmath=o.querySelector("input").checked;for(var r={},c=o.querySelectorAll("img"),m=0;m<c.length;m++){var u=c[m].id.slice(5);console.log(u);var h=r[u];h=void 0==h?1:h+1,r[u]=h}s.items=r,n.push(s)}i.blocks=n;var p=JSON.stringify(i),v=document.createElement("form");v.setAttribute("method","post"),v.setAttribute("action",e);var f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","item_set"),f.setAttribute("value",p),v.appendChild(f),document.body.appendChild(v),v.submit()}var filter=function(e,t){var n=document.getElementById(t+"-icons-div").querySelectorAll("img"),a=e.split(" ");for(k=0;k<n.length;k++){var l=n[k],d=l.alt.toLowerCase(),s=l.dataset.tags.toLowerCase();for(i=0;i<a.length;i++){var o=a[i],r="-"==o[0]?!0:!1;r&&(o=o.slice(1));var c=d.indexOf(o)>-1||s.indexOf(o)>-1?!0:!1;if(r||c){if(!r&&c)l.parentNode.classList.remove("hide");else if(r&&c){l.parentNode.classList.add("hide");break}}else l.parentNode.classList.add("hide")}}},filter_edit={img_type:"",bindEvents:function(e,t){this.img_type=t,e.addEventListener("click",this.editFilter);var i=e.querySelector("input");i.addEventListener("blur",this.updateFilter),i.addEventListener("keypress",this.keypressFilter)},editFilter:function(){var e=this.children[1];this.classList.add("edit"),e.focus,e.setSelectionRange(0,e.value.length)},updateFilter:function(){this.previousElementSibling.innerHTML=this.value,this.parentNode.classList.remove("edit"),filter(this.value.toLowerCase(),filter_edit.img_type)},keypressFilter:function(e){13===e.which&&filter_edit.updateFilter.call(this)}},stats_table={stats_names:{MPRegen:"Mana Regen",SpellBlock:"Magic Resist",Crit:"Critical Chance",AttackDamage:"Attack Damage",MP:"Mana",HPRegen:"Health Regen",HP:"Health",Armor:"Armor",MoveSpeed:"Move Speed",AttackSpeed:"Attack Speed",LifeSteal:"Life steal",SpellVamp:"Spellvamp",MagicDamage:"Ability Power"},champ_stats:"",stats_table:"",createTable:function(){var e=document.getElementById("stats-table-div"),t=document.createElement("table");t.id="stats-table";var i=e.dataset.stats;i=this.convertJSON(i)[0],delete i.ChampID_id,delete i.AttackRange,i.AttackSpeed=(.625/(1+parseFloat(i.AttackSpeedOffset))).toFixed(3),delete i.AttackSpeedOffset,i.MagicDamage=0,i.LifeSteal=0;var n=0,a=document.createElement("tr");for(stat in i){if(!~stat.indexOf("PerLevel")){var l=document.createElement("th"),d=document.createElement("td");l.classList.add("stats-header"),d.classList.add("stats-cell"),l.id=stat,l.appendChild(document.createTextNode(this.stats_names[stat])),d.appendChild(document.createTextNode(i[stat])),l.appendChild(d),a.appendChild(l),n++}n>=3&&(t.appendChild(a),a=document.createElement("tr"),n=0)}t.appendChild(a),e.appendChild(t),this.champ_stats=i,this.stats_table=t},trimStats:function(e){var t=~e.indexOf("Base")?!0:!1;e=t?e.slice(4):e;var i=~e.indexOf("Flat")?!0:!1;return t||(e=e.slice(i?4:7)),e=e.slice(0,-3),e=~e.indexOf("Pool")?e.slice(0,-4):e,e=~e.indexOf("PhysicalDamage")?"AttackDamage":e,e=~e.indexOf("MovementSpeed")?"MoveSpeed":e,e=~e.indexOf("CritChance")?"Crit":e},updateStats:function(e,t){t=this.convertJSON(t),delete t.ItemID_id;for(index_stat in t){var i=~index_stat.indexOf("Base")?!0:!1,n=(~index_stat.indexOf("Flat")?!0:!1,this.trimStats(index_stat)),a=document.getElementById(n).children[0],l=parseFloat(a.innerHTML),d=0;i?d+=this.champ_stats[n]*t[index_stat]/100:d="Crit"==n||"LifeSteal"==n?100*t[index_stat]:t[index_stat];var s=e?l+d:l-d;a.innerHTML=s.toFixed(3)}},convertJSON:function(e){return e=e.replace(/'/g,'"'),e=JSON.parse(e)},changeBlock:function(e){for(stat in this.champ_stats)if(!~stat.indexOf("PerLevel")){var t=document.getElementById(stat).children[0];t.innerHTML=this.champ_stats[stat]}var n=e.value,a=document.getElementById("blocks-table-"+n),l=a.querySelectorAll("img");for(i=0;i<l.length;i++)this.updateStats(!0,l[i].dataset.stats)}},number_of_blocks=-1,caption_edit={bindEvents:function(e){e.caption.addEventListener("click",this.editCaption),e.caption.children[1].addEventListener("blur",this.updateCaption),e.caption.children[1].addEventListener("keypress",this.keypressCaption)},editCaption:function(){var e=this.children[1];this.classList.add("edit"),e.focus,e.setSelectionRange(0,e.value.length)},updateCaption:function(){if(""!=this.value){this.previousElementSibling.innerHTML=this.value;var e=document.getElementById("block-selector"),t=e.children[id=this.parentNode.id];t.innerHTML=this.value}this.parentNode.classList.remove("edit")},keypressCaption:function(e){13===e.which&&caption_edit.updateCaption.call(this)}},add_listeners=function(){var e=document.getElementById("build");e.addEventListener("click",function(){build_item_set(e.dataset.url)});var t=document.getElementById("add");t.addEventListener("click",function(){add_block()});var n=document.getElementById("remove");n.addEventListener("click",function(){remove_block()});var a=document.getElementById("block-selector");a.addEventListener("change",function(){stats_table.changeBlock(this)});var l=document.getElementById("item-icons-div").querySelectorAll("img");for(i=0;i<l.length;i++)item=l[i],item.addEventListener("click",function(){item_info(this)}),item.addEventListener("dblclick",function(){add_item(this)});var d=document.getElementById("items-button");d.addEventListener("click",function(){toggle_items(this)});var s=document.getElementById("filter-div");filter_edit.bindEvents(s,"item");var o=document.getElementById("filter-buttons-div"),r=o.querySelector("#filter-all");r.addEventListener("click",function(){filter_string("")});var c=o.querySelector("#filter-attack");c.addEventListener("click",function(){filter_string("damage -spelldamage")});var m=o.querySelector("#filter-armor");m.addEventListener("click",function(){filter_string("armor")});var u=o.querySelector("#filter-health");u.addEventListener("click",function(){filter_string("health")});var h=o.querySelector("#filter-mana");h.addEventListener("click",function(){filter_string("mana")});var p=o.querySelector("#filter-consumable");p.addEventListener("click",function(){filter_string("consumable")});var v=o.querySelector("#filter-boots");v.addEventListener("click",function(){filter_string("boots -nonbootsmovement")});var f=o.querySelector("#filter-nonboots");f.addEventListener("click",function(){filter_string("nonbootsmovement")})};add_block(),stats_table.createTable(),add_listeners();